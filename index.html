<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Moti Mahal | Premium Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        #main-content { height: 100vh; }
        @media (min-width: 1024px) { #main-content { height: 90vh; max-height: 900px; } }
        .fixed-bottom-center {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 48px);
            max-width: 450px;
            z-index: 50;
        }
        .modal-overlay {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 min-h-screen">

    <div id="app" class="min-h-screen w-full flex items-center justify-center p-0 md:p-4">
        <div id="main-content" class="w-full max-w-full lg:max-w-5xl flex flex-col lg:flex-row bg-white lg:rounded-[2.5rem] lg:shadow-2xl overflow-hidden relative">
            <div id="loading-screen" class="absolute inset-0 z-50 flex items-center justify-center bg-white">
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mb-4"></div>
                    <p class="text-sm text-slate-400 font-bold tracking-widest uppercase">Moti Mahal Delivery</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Updated SDKs to 12.7.0 based on your snippet
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        // âœ… NEW CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyAonawasJyQbrdTnYAQ2dKrFRF9VMT2wx0",
            authDomain: "motijheel-swiggy.firebaseapp.com",
            projectId: "motijheel-swiggy",
            storageBucket: "motijheel-swiggy.firebasestorage.app",
            messagingSenderId: "164653037284",
            appId: "1:164653037284:web:f3663dee0e54b501f31ef1"
        };
        
        // Internal variable for DB pathing (Updated to match new Project ID)
        const appId = "motijheel-swiggy";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Passwords
        const KITCHEN_PASSWORD = "Moti2025Mahal";
        const ADMIN_PASSWORD = "Motijheel2025Lalbagh";

        const VARIANT_MAPS = {
            'C': ['Veg', 'Chicken', 'Mixed'],
            'L': ['Small', 'Large'],
            'D': ['Broiler', 'Desi']
        };
        
        const COUNTRY_CODES = [
            { code: "+91", label: "ðŸ‡®ðŸ‡³ +91" },
            { code: "+1", label: "ðŸ‡ºðŸ‡¸ +1" },
            { code: "+44", label: "ðŸ‡¬ðŸ‡§ +44" },
            { code: "+971", label: "ðŸ‡¦ðŸ‡ª +971" },
            { code: "+880", label: "ðŸ‡§ðŸ‡© +880" },
            { code: "+61", label: "ðŸ‡¦ðŸ‡º +61" },
            { code: "+65", label: "ðŸ‡¸ðŸ‡¬ +65" }
        ];

        const MENU_DATA = [
            { id: 1, name: "Tomato & Basil Soup", price: 129, cat: "Soup" },
            { id: 2, name: "Choice of Cream Soup", prices: [129, 149], type: 'C', cat: "Soup" },
            { id: 3, name: "Carrot Almond Soup", prices: [129, 149], type: 'L', cat: "Soup" },
            { id: 4, name: "Manchow Soup", prices: [129, 149], type: 'C', cat: "Soup" },
            { id: 5, name: "Lemon Coriander Soup", prices: [129, 149], type: 'C', cat: "Soup" },
            { id: 6, name: "Tom Yum Soup", prices: [129, 149], type: 'C', cat: "Soup" },
            { id: 7, name: "Green Salad", price: 99, cat: "Salad" },
            { id: 8, name: "Caesar Salad", prices: [169, 199], type: 'L', cat: "Salad" },
            { id: 9, name: "Waldorf Salad", prices: [199, 239], type: 'L', cat: "Salad" },
            { id: 10, name: "Greek Salad", prices: [189, 229], type: 'L', cat: "Salad" },
            { id: 11, name: "Chicken Tikka Smoked Salad", price: 229, cat: "Salad" },
            { id: 12, name: "Cheese Chickpeas Finger", price: 159, cat: "Small Bite" },
            { id: 13, name: "French Fries", price: 139, cat: "Small Bite" },
            { id: 14, name: "Nachos with Salsa", price: 169, cat: "Small Bite" },
            { id: 15, name: "Pakoda", price: 129, cat: "Small Bite" },
            { id: 16, name: "Kolkata Fish Fry", price: 199, cat: "Small Bite" },
            { id: 17, name: "Fish Finger", price: 189, cat: "Small Bite" },
            { id: 18, name: "Nawabi Devil", prices: [169, 189], type: 'C', cat: "Small Bite" },
            { id: 19, name: "Chicken Pakoda", price: 169, cat: "Small Bite" },
            { id: 20, name: "Ambi Paneer Tikka", price: 249, cat: "Appetizers" },
            { id: 21, name: "Koraishuti Tikka", price: 229, cat: "Appetizers" },
            { id: 22, name: "Malai Broccoli", price: 249, cat: "Appetizers" },
            { id: 23, name: "Nawabi Moti Murgh Kebab", price: 289, cat: "Appetizers" },
            { id: 24, name: "Siraji Galouti Kebab", price: 349, cat: "Appetizers" },
            { id: 25, name: "Murgh Shahi Bhatina", price: 289, cat: "Appetizers" },
            { id: 26, name: "Bhatti Ka Murgh Tikka", price: 279, cat: "Appetizers" },
            { id: 27, name: "Gandharaj Murgh Tikka", price: 349, cat: "Appetizers" },
            { id: 28, name: "Fish Mahi Tikka", price: 449, cat: "Appetizers" },
            { id: 29, name: "Prawn Lasooni Tikka", price: 479, cat: "Appetizers" },
            { id: 30, name: "Tandoori Arabian Pomfret", price: 499, cat: "Appetizers" },
            { id: 31, name: "Crispy Chilli Baby Corn", price: 229, cat: "Appetizers" },
            { id: 32, name: "Paneer 65", price: 249, cat: "Appetizers" },
            { id: 33, name: "Soya Chilli Paneer", price: 239, cat: "Appetizers" },
            { id: 34, name: "Wood Fire Chicken Chilli", price: 269, cat: "Appetizers" },
            { id: 35, name: "Hunan Chicken", price: 279, cat: "Appetizers" },
            { id: 36, name: "Tai Pai Kai", price: 279, cat: "Appetizers" },
            { id: 37, name: "Thai Basil Chicken", price: 289, cat: "Appetizers" },
            { id: 38, name: "Bamboo Cashewnut Chicken", price: 299, cat: "Appetizers" },
            { id: 39, name: "Sweet & Spicy Crispy Chicken", price: 289, cat: "Appetizers" },
            { id: 40, name: "Teriyaki Chicken", price: 289, cat: "Appetizers" },
            { id: 41, name: "Chicken 65", price: 279, cat: "Appetizers" },
            { id: 42, name: "Roasted Chicken in Chilli Plum Sauce", price: 299, cat: "Appetizers" },
            { id: 43, name: "Pan Fried Chilli Fish", price: 349, cat: "Appetizers" },
            { id: 44, name: "Fish in Tangy Mustard", price: 369, cat: "Appetizers" },
            { id: 45, name: "Prawn Chilli Basil (Dry)", price: 479, cat: "Appetizers" },
            { id: 46, name: "Choice of Raita", price: 129, cat: "Sides" },
            { id: 47, name: "Plain Curd", price: 69, cat: "Sides" },
            { id: 48, name: "Papad", price: 79, cat: "Sides" },
            { id: 49, name: "Masala Peanut", price: 149, cat: "Sides" },
            { id: 50, name: "Fried Cashewnuts", price: 249, cat: "Sides" },
            { id: 51, name: "Dal Tadka", price: 149, cat: "Indian" },
            { id: 52, name: "Dal Makhani", price: 179, cat: "Indian" },
            { id: 53, name: "Yellow Dal Fry", price: 129, cat: "Indian" },
            { id: 54, name: "Paneer (Makhani/Kadhai/Lababdar/Palak)", price: 249, cat: "Indian" },
            { id: 55, name: "Tawa Veg", price: 229, cat: "Indian" },
            { id: 56, name: "Aloo Do Pyaza", price: 199, cat: "Indian" },
            { id: 57, name: "Butter Chicken", price: 289, cat: "Indian" },
            { id: 58, name: "Chicken Bharta", price: 279, cat: "Indian" },
            { id: 59, name: "Chicken Do Pyaza", price: 289, cat: "Indian" },
            { id: 60, name: "Mutton (Kosha/Rogan Josh/Do Pyaza)", price: 479, cat: "Indian" },
            { id: 61, name: "Prawn Butter Masala", price: 479, cat: "Indian" },
            { id: 62, name: "Tandoor Roti", prices: [49, 59], type: 'L', cat: "Rice & Roti" },
            { id: 63, name: "Naan", prices: [59, 69], type: 'L', cat: "Rice & Roti" },
            { id: 64, name: "Stuffed Kulcha", price: 99, cat: "Rice & Roti" },
            { id: 65, name: "Lachha Paratha", price: 59, cat: "Rice & Roti" },
            { id: 66, name: "Steamed Rice", price: 99, cat: "Rice & Roti" },
            { id: 67, name: "Veg Pulao", price: 169, cat: "Rice & Roti" },
            { id: 68, name: "Basanti Pulao", price: 179, cat: "Rice & Roti" },
            { id: 69, name: "Bengali Kaju Kishmish Pulao", price: 179, cat: "Rice & Roti" },
            { id: 70, name: "Jeera Rice", price: 149, cat: "Rice & Roti" },
            { id: 71, name: "Dum Biryani", prices: [149, 249], type: 'C', cat: "Rice & Roti" },
            { id: 72, name: "Special Biryani", prices: [249, 399], type: 'C', cat: "Rice & Roti" },
            { id: 73, name: "Sizzler Biryani", prices: [249, 399], type: 'C', cat: "Rice & Roti" },
            { id: 74, name: "Narkel Diya Postor Bora", price: 259, cat: "Flavours of Bengal" },
            { id: 75, name: "Jhuri Aloo Bhaja", price: 99, cat: "Flavours of Bengal" },
            { id: 76, name: "Begun Bhaja", price: 99, cat: "Flavours of Bengal" },
            { id: 77, name: "Aloo Posto", price: 179, cat: "Flavours of Bengal" },
            { id: 78, name: "Phulkopir Roast", price: 179, cat: "Flavours of Bengal" },
            { id: 79, name: "Channar Dalna", price: 239, cat: "Flavours of Bengal" },
            { id: 80, name: "Plain Masoor Dal", price: 99, cat: "Flavours of Bengal" },
            { id: 81, name: "Bhaja Moong Dal", price: 129, cat: "Flavours of Bengal" },
            { id: 82, name: "Macher Matha Diye Moong Dal", price: 149, cat: "Flavours of Bengal" },
            { id: 83, name: "Kacha Lanka Dhonepata Murgi", prices: [279, 379], type: 'D', cat: "Flavours of Bengal" },
            { id: 84, name: "Daab Murgi", prices: [289, 399], type: 'D', cat: "Flavours of Bengal" },
            { id: 85, name: "Kosha Murgi", prices: [249, 379], type: 'D', cat: "Flavours of Bengal" },
            { id: 86, name: "Borisaler Bhapa Murgi", prices: [289, 399], type: 'D', cat: "Flavours of Bengal" },
            { id: 87, name: "Kacha Lanka Mangsho", price: 399, cat: "Flavours of Bengal" },
            { id: 88, name: "Morich Mangsho", price: 399, cat: "Flavours of Bengal" },
            { id: 89, name: "Ilish Bhapa", price: 349, cat: "Flavours of Bengal" },
            { id: 90, name: "Begun Ilish", price: 319, cat: "Flavours of Bengal" },
            { id: 91, name: "Chingri Malai Curry", price: 449, cat: "Flavours of Bengal" },
            { id: 92, name: "Bhetki Bhapa", price: 499, cat: "Flavours of Bengal" },
            { id: 93, name: "Bhetki Paturi", price: 349, cat: "Flavours of Bengal" },
            { id: 94, name: "Katla Kalia", price: 199, cat: "Flavours of Bengal" },
            { id: 95, name: "Katla Bhapa", price: 229, cat: "Flavours of Bengal" },
            { id: 96, name: "Arrabiata Pasta", prices: [249, 299], type: 'L', cat: "Continental" },
            { id: 97, name: "Mama Rossa Pasta", prices: [249, 299], type: 'L', cat: "Continental" },
            { id: 98, name: "Creamy Cheese Sauce Pasta", prices: [259, 309], type: 'L', cat: "Continental" },
            { id: 99, name: "Spaghetti Aglio e Olio", prices: [299, 349], type: 'L', cat: "Continental" },
            { id: 100, name: "Au Gratin", prices: [339, 369], type: 'L', cat: "Continental" },
            { id: 101, name: "Baked Pasta", prices: [299, 349], type: 'L', cat: "Continental" },
            { id: 102, name: "Chicken Stroganoff", price: 359, cat: "Continental" },
            { id: 103, name: "Cottage Cheese Steak Sizzler", price: 359, cat: "Continental" },
            { id: 104, name: "Grilled Fish with Lemon Butter Sauce", price: 429, cat: "Continental" },
            { id: 105, name: "Grilled Chicken Steak Sizzler", price: 349, cat: "Continental" },
            { id: 106, name: "Classic Margherita Pizza", price: 249, cat: "Continental" },
            { id: 107, name: "Paneer Makhni Pizza", price: 289, cat: "Continental" },
            { id: 108, name: "BBQ Chicken Pizza", price: 329, cat: "Continental" },
            { id: 109, name: "Chicken Makhani Pizza", price: 349, cat: "Continental" },
            { id: 110, name: "Chinese Fried Rice", prices: [199, 249, 299], type: 'C', cat: "Asian" },
            { id: 111, name: "Schezwan Fried Rice", prices: [219, 259, 319], type: 'C', cat: "Asian" },
            { id: 112, name: "Burnt Garlic Fried Rice", prices: [219, 259, 319], type: 'C', cat: "Asian" },
            { id: 113, name: "Singaporean Rice", prices: [219, 259, 319], type: 'C', cat: "Asian" },
            { id: 114, name: "Mongolian Rice", prices: [249, 289, 349], type: 'C', cat: "Asian" },
            { id: 115, name: "Hakka Noodles", prices: [199, 249, 299], type: 'C', cat: "Asian" },
            { id: 116, name: "Chilli Garlic Hakka Noodles", prices: [219, 259, 319], type: 'C', cat: "Asian" },
            { id: 117, name: "Schezwan Hakka Noodles", prices: [219, 259, 319], type: 'C', cat: "Asian" },
            { id: 118, name: "Cantonese Noodles", prices: [249, 289, 349], type: 'C', cat: "Asian" },
            { id: 119, name: "Pan Fried Noodles", prices: [249, 289, 349], type: 'C', cat: "Asian" },
            { id: 120, name: "Mongolian Noodles", prices: [249, 289, 349], type: 'C', cat: "Asian" },
            { id: 121, name: "Paneer in Sauce", price: 269, cat: "Asian" },
            { id: 122, name: "Mushroom in Sauce", price: 249, cat: "Asian" },
            { id: 123, name: "Chicken in Sauce", price: 279, cat: "Asian" },
            { id: 124, name: "Fish in Sauce", price: 339, cat: "Asian" },
            { id: 125, name: "Prawn in Sauce", price: 349, cat: "Asian" },
            { id: 126, name: "Hot Chhanar Malpua", price: 119, cat: "Dessert" },
            { id: 127, name: "Bengali Baked Rasgulla", price: 119, cat: "Dessert" },
            { id: 128, name: "Blueberry Cheesecake", price: 159, cat: "Dessert" },
            { id: 129, name: "Brownie", price: 119, cat: "Dessert" },
            { id: 130, name: "Tutti Frutti Sundae", price: 139, cat: "Dessert" },
            { id: 131, name: "Ice Cream", price: 99, cat: "Dessert" }
        ];

        const CATEGORIES = ["All", ...new Set(MENU_DATA.map(i => i.cat))];

        window.state = {
            view: 'welcome',
            cart: [],
            activeCategory: 'All',
            phoneNumber: '',
            countryCode: '+91',
            address: '',
            activeOrderId: null,
            orders: [],
            user: null,
            isPlacingOrder: false,
            variantModal: null,
            lookupError: '',
            lookupMethod: 'token', // 'token' or 'details'
            lookupCountryCode: '+91'
        };

        window.setState = (update) => {
            window.state = { ...window.state, ...update };
            render();
        };

        async function initApp() {
            try {
                const userCred = await signInAnonymously(auth);
                window.state.user = userCred.user;
                setupSync();
            } catch (e) { console.error("Auth failed:", e); }
        }

        function setupSync() {
            if (!window.state.user) return;
            const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
            onSnapshot(ordersRef, (snapshot) => {
                const orders = [];
                snapshot.forEach(doc => orders.push({ cloudId: doc.id, ...doc.data() }));
                window.state.orders = orders.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                document.getElementById('loading-screen')?.classList.add('hidden');
                render();
            });
        }

        window.handleAddToCart = (item) => {
            if (item.prices) { window.setState({ variantModal: { item } }); return; }
            addToCartLogic(item.name, item.price, item.id);
        };

        window.addVariantToCart = (variantName, variantPrice) => {
            const item = window.state.variantModal.item;
            addToCartLogic(`${item.name} (${variantName})`, variantPrice, `${item.id}-${variantName}`);
            window.setState({ variantModal: null });
        };

        function addToCartLogic(displayName, price, uniqueId) {
            const existing = window.state.cart.find(i => i.uid === uniqueId);
            if (existing) { existing.qty++; }
            else { window.state.cart.push({ name: displayName, price, qty: 1, uid: uniqueId }); }
            render();
        }

        window.placeOrder = async () => {
            if (window.state.isPlacingOrder) return;
            if (!window.state.address || window.state.phoneNumber.length < 5) {
                const err = document.getElementById('form-error');
                if(err) err.classList.remove('hidden');
                return;
            }

            window.setState({ isPlacingOrder: true });
            try {
                const orderId = "MOT-" + Math.random().toString(36).substr(2, 4).toUpperCase();
                const subTotal = window.state.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                const fullPhone = window.state.countryCode + window.state.phoneNumber;
                
                const newOrder = {
                    id: orderId,
                    address: window.state.address, // Changed from room to address
                    phone: fullPhone,
                    items: window.state.cart,
                    total: Math.round(subTotal * 1.05),
                    status: 0, 
                    timestamp: serverTimestamp(),
                    time: new Date().toLocaleString()
                };

                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);
                window.setState({ view: 'tracking', activeOrderId: orderId, cart: [], isPlacingOrder: false });
            } catch (err) { window.setState({ isPlacingOrder: false }); }
        };

        window.lookupOrder = () => {
            const method = window.state.lookupMethod;
            let order = null;

            if (method === 'token') {
                const token = document.getElementById('look-token').value.trim().toUpperCase();
                order = window.state.orders.find(o => o.id === token);
            } else {
                const houseNo = document.getElementById('look-room').value.trim(); // Using the ID from room logic, but checks address
                const phoneInput = document.getElementById('look-phone').value.trim();
                const fullPhone = window.state.lookupCountryCode + phoneInput;
                
                // Matches if the address string contains the house/flat number input
                order = window.state.orders.find(o => 
                    o.address.includes(houseNo) && o.phone === fullPhone
                );
            }

            if (order) {
                window.setState({ activeOrderId: order.id, view: 'tracking', lookupError: '' });
            } else {
                window.setState({ lookupError: 'Order not found. Please check your details.' });
            }
        };

        window.updateStatus = async (cloudId, currentStatus, targetStatus) => {
            // Enforcement: Move only one step at a time
            if (targetStatus !== currentStatus + 1) return;

            // Step 3 (Done) requires photo
            if (targetStatus === 3) {
                const fileInput = document.getElementById(`photo-upload-${cloudId}`);
                if (!fileInput.files || !fileInput.files[0]) {
                    alert("Order completion requires a photo upload.");
                    return;
                }
                
                const reader = new FileReader();
                reader.onloadend = async () => {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId), { 
                        status: targetStatus,
                        completionPhoto: reader.result,
                        completedAt: serverTimestamp()
                    });
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId), { status: targetStatus });
            }
        };

        window.deleteOrder = async (cloudId) => {
            if(confirm("Permanently delete this order record?")) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId));
            }
        }

        function render() {
            const container = document.getElementById('main-content');
            if (!container) return;
            const cartCount = window.state.cart.reduce((a, b) => a + b.qty, 0);

            if (window.state.view === 'welcome') {
                container.innerHTML = `
                    <div class="flex-1 flex flex-col items-center justify-center p-8 text-center bg-white animate-fade-in relative">
                        <div class="mb-10">
                            <h1 class="text-4xl md:text-6xl font-black tracking-tighter text-slate-900 leading-none">Moti Mahal</h1>
                            <p class="text-orange-500 font-bold text-xs uppercase tracking-[0.4em] mt-4">Premium Delivery Service</p>
                        </div>
                        <div class="w-full max-w-xs space-y-4">
                            <a href="https://drive.google.com/file/d/17oKaCzkIvZGyeUlRlzSUUTvhFUsu_qEH/view?usp=sharing" target="_blank" class="block w-full bg-slate-100 text-slate-900 p-6 rounded-[2rem] font-bold text-xl active:scale-95 transition-all text-center">View Menu</a>
                            <button onclick="setState({view: 'user'})" class="w-full bg-slate-900 text-white p-6 rounded-[2rem] font-bold text-xl shadow-xl active:scale-95 transition-all">Order Now</button>
                            <button onclick="setState({view: 'order_lookup'})" class="w-full bg-white border-2 border-slate-100 p-5 rounded-[2rem] font-bold text-slate-400 active:scale-95 transition-all">Track Order</button>
                        </div>

                        <div class="mt-8 text-center">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Need Assistance?</p>
                            <a href="tel:+918001365465" class="inline-flex items-center gap-2 text-slate-900 font-black bg-white px-4 py-2 rounded-full border border-slate-100 shadow-sm hover:border-orange-500 hover:text-orange-600 transition-colors">
                                <i data-lucide="phone" class="w-4 h-4 text-orange-500"></i>
                                +91 80013 65465
                            </a>
                        </div>
                        
                        <button onclick="setState({view: 'admin_login'})" class="absolute bottom-8 left-8 w-10 h-10 rounded-full border-2 border-slate-100 flex items-center justify-center text-slate-200 transition-colors hover:text-slate-400">
                            <i data-lucide="circle" class="w-4 h-4 fill-current"></i>
                        </button>
                        
                        <button onclick="setState({view: 'kitchen_login'})" class="absolute bottom-8 right-8 text-slate-100 p-4 transition-colors hover:text-orange-500">
                            <i data-lucide="shield-check"></i>
                        </button>
                    </div>
                `;
            } 
            else if (['user', 'checkout', 'tracking', 'order_lookup'].includes(window.state.view)) {
                const isStatus = ['tracking', 'order_lookup'].includes(window.state.view);
                container.innerHTML = `
                    <div class="flex-1 flex flex-col h-full bg-white animate-fade-in relative">
                        <header class="p-6 border-b sticky top-0 bg-white z-40 flex justify-between items-center">
                            <h2 onclick="setState({view: 'welcome'})" class="font-black text-xl cursor-pointer">Moti Mahal</h2>
                            <div class="flex bg-slate-100 p-1 rounded-2xl">
                                <button onclick="setState({view: 'user'})" class="px-5 py-2 rounded-xl text-[10px] font-black uppercase tracking-wider ${!isStatus ? 'bg-white shadow-sm' : 'text-slate-400'}">Menu</button>
                                <button onclick="setState({view: 'order_lookup'})" class="px-5 py-2 rounded-xl text-[10px] font-black uppercase tracking-wider ${isStatus ? 'bg-white shadow-sm' : 'text-slate-400'}">Status</button>
                            </div>
                        </header>

                        <main class="flex-1 overflow-y-auto p-4 md:p-6 pb-32 custom-scrollbar">
                            ${window.state.view === 'user' ? `
                                <div class="max-w-3xl mx-auto">
                                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-6 sticky top-0 bg-white z-30">
                                        ${CATEGORIES.map(c => `
                                            <button onclick="setState({activeCategory: '${c}'})" class="whitespace-nowrap px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest border transition-all ${window.state.activeCategory === c ? 'bg-slate-900 text-white border-slate-900' : 'bg-white text-slate-400 border-slate-100'}">${c}</button>
                                        `).join('')}
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4">
                                        ${MENU_DATA.filter(m => window.state.activeCategory === 'All' || m.cat === window.state.activeCategory).map(item => `
                                            <div class="bg-white p-6 rounded-[2.5rem] border border-slate-100 flex justify-between items-center group hover:border-orange-200 transition-all">
                                                <div class="flex-1 pr-4">
                                                    <h3 class="font-bold text-slate-900 text-base leading-tight">${item.name}</h3>
                                                    <p class="text-orange-500 font-black text-sm mt-1">${item.price ? 'â‚¹'+item.price : 'Starting â‚¹'+item.prices[0]}</p>
                                                </div>
                                                <button onclick="handleAddToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="p-4 bg-slate-50 group-hover:bg-slate-900 group-hover:text-white rounded-2xl transition-all active:scale-90">
                                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            ${window.state.view === 'checkout' ? `
                                <div class="max-w-xl mx-auto space-y-6">
                                    <div class="bg-slate-50 p-8 rounded-[3rem] space-y-4">
                                        <h3 class="font-black text-xl px-2">Delivery Details</h3>
                                        <div id="form-error" class="hidden bg-red-50 text-red-500 p-4 rounded-2xl text-xs font-bold text-center">Enter valid delivery address & phone</div>
                                        
                                        <textarea placeholder="Delivery Address (House No, Street, Landmark)" oninput="window.state.address=this.value" class="w-full p-6 bg-white border border-slate-100 rounded-[2rem] outline-none font-bold h-32 resize-none">${window.state.address}</textarea>
                                        
                                        <div class="flex gap-2">
                                            <select onchange="window.state.countryCode=this.value" class="p-6 bg-white border border-slate-100 rounded-[2rem] outline-none font-bold min-w-[100px] text-center">
                                                ${COUNTRY_CODES.map(c => `<option value="${c.code}" ${c.code === window.state.countryCode ? 'selected' : ''}>${c.label}</option>`).join('')}
                                            </select>
                                            <input type="tel" placeholder="Phone Number" oninput="window.state.phoneNumber=this.value" value="${window.state.phoneNumber}" class="flex-1 p-6 bg-white border border-slate-100 rounded-[2rem] outline-none font-bold">
                                        </div>
                                    </div>
                                    <div class="bg-slate-900 text-white p-8 rounded-[3rem] shadow-xl">
                                        <div class="space-y-4">
                                            ${window.state.cart.map(i => `
                                                <div class="flex justify-between items-center text-sm">
                                                    <span class="flex items-center gap-3">
                                                        <span class="w-6 h-6 rounded-lg bg-white/10 flex items-center justify-center text-[10px] font-black">${i.qty}</span>
                                                        <span class="font-medium">${i.name}</span>
                                                    </span>
                                                    <span class="font-black text-white/60">â‚¹${i.price * i.qty}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="mt-8 pt-8 border-t border-white/10 flex justify-between items-center">
                                            <div class="flex flex-col">
                                                <span class="font-bold opacity-40 text-[10px] uppercase tracking-widest">Grand Total</span>
                                                <span class="text-3xl font-black text-orange-400">â‚¹${Math.round(window.state.cart.reduce((a,b)=>a+(b.price*b.qty),0)*1.05)}</span>
                                            </div>
                                            <i data-lucide="receipt" class="w-8 h-8 opacity-20"></i>
                                        </div>
                                    </div>
                                    <button onclick="placeOrder()" class="w-full ${window.state.isPlacingOrder ? 'bg-slate-300' : 'bg-orange-500 hover:bg-orange-600'} text-white p-7 rounded-[2.5rem] font-black text-xl shadow-xl transition-all">
                                        ${window.state.isPlacingOrder ? 'Submitting...' : 'Confirm Delivery'}
                                    </button>
                                </div>
                            ` : ''}

                            ${window.state.view === 'order_lookup' ? `
                                <div class="max-w-md mx-auto py-12">
                                    <div class="mb-8 flex flex-col items-center text-center">
                                        <div class="w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mb-6">
                                            <i data-lucide="search" class="text-orange-500 w-8 h-8"></i>
                                        </div>
                                        <h2 class="font-black text-2xl">Track Delivery</h2>
                                    </div>

                                    <div class="flex p-1 bg-slate-100 rounded-2xl mb-6">
                                        <button onclick="setState({lookupMethod: 'token', lookupError: ''})" class="flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-wider transition-all ${window.state.lookupMethod === 'token' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400'}">Option 1: Token</button>
                                        <button onclick="setState({lookupMethod: 'details', lookupError: ''})" class="flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-wider transition-all ${window.state.lookupMethod === 'details' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400'}">Option 2: Details</button>
                                    </div>

                                    ${window.state.lookupError ? `<p class="bg-red-50 text-red-500 text-[10px] font-black p-4 rounded-2xl text-center border border-red-100 mb-6 animate-fade-in">${window.state.lookupError}</p>` : ''}
                                    
                                    <div class="space-y-3">
                                        ${window.state.lookupMethod === 'token' ? `
                                            <div class="animate-fade-in">
                                                <input type="text" id="look-token" placeholder="Order Token (e.g. MOT-ABCD)" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] font-black outline-none focus:border-orange-500 transition-colors uppercase text-center tracking-widest">
                                                <p class="text-center text-[10px] font-bold text-slate-400 mt-4">Enter the token ID shown on your receipt</p>
                                            </div>
                                        ` : `
                                            <div class="space-y-3 animate-fade-in">
                                                <input type="text" id="look-room" placeholder="House/Flat Number" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] font-black outline-none focus:border-orange-500 transition-colors">
                                                <div class="flex gap-2">
                                                    <select onchange="window.state.lookupCountryCode=this.value" class="p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] outline-none font-bold min-w-[100px] text-center focus:border-orange-500">
                                                        ${COUNTRY_CODES.map(c => `<option value="${c.code}" ${c.code === window.state.lookupCountryCode ? 'selected' : ''}>${c.label}</option>`).join('')}
                                                    </select>
                                                    <input type="tel" id="look-phone" placeholder="Phone Number" class="flex-1 p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] font-black outline-none focus:border-orange-500 transition-colors">
                                                </div>
                                            </div>
                                        `}
                                        <button onclick="lookupOrder()" class="w-full bg-slate-900 text-white p-6 rounded-[2rem] font-bold shadow-lg mt-6 active:scale-95 transition-all">Check Status</button>
                                    </div>
                                </div>
                            ` : ''}

                            ${window.state.view === 'tracking' ? `
                                <div class="flex flex-col items-center py-10 max-w-sm mx-auto">
                                    ${(()=>{
                                        const order = window.state.orders.find(o => o.id === window.state.activeOrderId);
                                        if (!order) return `<div class="animate-pulse text-slate-300 font-black">LOCATING...</div>`;
                                        const steps = ["Received", "Preparing", "On the Way", "Delivered"];
                                        return `
                                            <div class="bg-slate-900 w-full rounded-[3rem] p-8 text-white mb-10 text-center shadow-2xl overflow-hidden">
                                                <p class="text-[10px] font-black tracking-[0.3em] opacity-50 mb-2 uppercase">${order.id}</p>
                                                <h2 class="text-3xl font-black mb-1 text-orange-400">${steps[order.status]}</h2>
                                                <p class="text-xs opacity-50 mt-2 font-bold uppercase tracking-widest break-words px-2">${order.address}</p>
                                            </div>
                                            <div class="w-full space-y-10">
                                                ${steps.map((s, idx) => `
                                                    <div class="flex items-center gap-6">
                                                        <div class="relative">
                                                            <div class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all ${order.status >= idx ? 'bg-orange-500 text-white shadow-lg shadow-orange-500/30' : 'bg-slate-100 text-slate-300'}">
                                                                <i data-lucide="${idx === 0 ? 'file-text' : idx === 1 ? 'flame' : idx === 2 ? 'truck' : 'check'}" class="w-5 h-5"></i>
                                                            </div>
                                                            ${idx < 3 ? `<div class="absolute top-12 left-6 w-0.5 h-10 -ml-[1px] ${order.status > idx ? 'bg-orange-500' : 'bg-slate-100'}"></div>` : ''}
                                                        </div>
                                                        <div class="flex flex-col">
                                                            <span class="font-black text-sm uppercase tracking-wider ${order.status >= idx ? 'text-slate-900' : 'text-slate-300'}">${s}</span>
                                                            <span class="text-[10px] font-bold opacity-40">${order.status === idx ? 'Now' : order.status > idx ? 'Done' : 'Wait'}</span>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>

                                            <div class="mt-12 pt-8 w-full border-t border-slate-100 text-center">
                                                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Delays or Issues?</p>
                                                <a href="tel:+918001365465" class="inline-flex items-center gap-2 text-slate-900 font-bold bg-slate-50 px-5 py-3 rounded-2xl hover:bg-orange-50 hover:text-orange-600 transition-colors">
                                                    <i data-lucide="phone-call" class="w-4 h-4"></i>
                                                    Call +91 80013 65465
                                                </a>
                                            </div>
                                        `;
                                    })()}
                                </div>
                            ` : ''}
                        </main>

                        ${window.state.view === 'user' && cartCount > 0 ? `
                            <div class="fixed-bottom-center animate-fade-in">
                                <button onclick="setState({view: 'checkout'})" class="w-full bg-slate-900 text-white p-6 rounded-[2.2rem] flex justify-between items-center shadow-2xl font-bold hover:scale-[1.02] transition-transform">
                                    <span class="flex items-center gap-3">
                                        <span class="bg-orange-500 w-8 h-8 rounded-full flex items-center justify-center text-xs font-black">${cartCount}</span>
                                        <span class="uppercase tracking-widest text-[11px]">View Order</span>
                                    </span>
                                    <span class="text-orange-400 font-black">â‚¹${window.state.cart.reduce((a,b)=>a+(b.price*b.qty),0)}</span>
                                </button>
                            </div>
                        ` : ''}

                        ${window.state.variantModal ? `
                            <div class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 modal-overlay animate-fade-in">
                                <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl flex flex-col items-center">
                                    <h3 class="font-black text-xl text-center mb-1">${window.state.variantModal.item.name}</h3>
                                    <p class="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mb-8">Select Preference</p>
                                    <div class="w-full space-y-3">
                                        ${window.state.variantModal.item.prices.map((price, idx) => {
                                            const label = VARIANT_MAPS[window.state.variantModal.item.type]?.[idx] || 'Selection ' + (idx+1);
                                            return `
                                                <button onclick="addVariantToCart('${label}', ${price})" class="w-full p-6 rounded-[2rem] border-2 border-slate-50 hover:border-orange-500 hover:bg-orange-50 flex justify-between items-center transition-all group">
                                                    <span class="font-black text-slate-700 group-hover:text-orange-600">${label}</span>
                                                    <span class="font-black text-orange-500">â‚¹${price}</span>
                                                </button>
                                            `;
                                        }).join('')}
                                    </div>
                                    <button onclick="setState({variantModal: null})" class="mt-6 text-slate-300 text-xs font-black uppercase tracking-widest">Cancel</button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            } 
            else if (['kitchen_login', 'kitchen'].includes(window.state.view)) {
                container.innerHTML = `
                    <div class="flex-1 bg-slate-950 text-white flex flex-col h-full overflow-hidden">
                        ${window.state.view === 'kitchen_login' ? `
                            <div class="flex-1 flex flex-col items-center justify-center p-8">
                                <i data-lucide="utensils-crossed" class="w-12 h-12 text-orange-500 mb-6"></i>
                                <h2 class="text-2xl font-black mb-8">Kitchen Login</h2>
                                <input id="kit-pwd" type="password" placeholder="Kitchen Passcode" class="w-full max-w-xs bg-white/5 p-6 rounded-[2rem] text-center mb-4 text-white outline-none border border-white/10 font-black">
                                <button onclick="if(document.getElementById('kit-pwd').value==='${KITCHEN_PASSWORD}') setState({view:'kitchen'})" class="w-full max-w-xs bg-orange-500 p-6 rounded-[2rem] font-black">Open Kitchen</button>
                                <button onclick="setState({view:'welcome'})" class="mt-6 text-white/30 text-xs font-black">Cancel</button>
                            </div>
                        ` : `
                            <header class="p-8 border-b border-white/10 shrink-0 flex justify-between items-center">
                                <h2 class="font-black text-2xl tracking-tighter">Kitchen Dashboard</h2>
                                <button onclick="setState({view:'welcome'})" class="bg-white/5 p-4 rounded-2xl"><i data-lucide="x"></i></button>
                            </header>
                            <div class="flex-1 overflow-y-auto p-8 space-y-6 bg-slate-950 custom-scrollbar">
                                ${window.state.orders.length === 0 ? '<p class="text-center opacity-20 py-20 font-black">NO ACTIVE ORDERS</p>' : ''}
                                ${window.state.orders.map(o => `
                                    <div class="bg-white/5 p-8 rounded-[3rem] border border-white/10 ${o.status === 3 ? 'opacity-40 grayscale' : ''}">
                                        <div class="flex justify-between items-start mb-6">
                                            <div class="flex-1 pr-4">
                                                <h4 class="font-black text-base text-orange-400 break-words">${o.address}</h4>
                                                <p class="text-white/30 text-[10px] font-bold uppercase tracking-widest mt-1">${o.id} â€¢ ${o.phone}</p>
                                            </div>
                                            <div class="flex flex-wrap gap-2 shrink-0">
                                                ${["Recv", "Prep", "Way", "Done"].map((s, idx) => {
                                                    const isNext = idx === o.status + 1;
                                                    const isCurrent = idx === o.status;
                                                    return `
                                                        <div class="flex flex-col items-center gap-2">
                                                            <button onclick="updateStatus('${o.cloudId}', ${o.status}, ${idx})" 
                                                                class="px-4 py-2 rounded-xl text-[9px] font-black uppercase transition-all 
                                                                ${isCurrent ? 'bg-orange-500 text-white shadow-lg' : isNext ? 'bg-white/10 text-white' : 'bg-white/5 text-white/20 cursor-not-allowed'}">
                                                                ${s}
                                                            </button>
                                                            ${idx === 3 && isNext ? `
                                                                <label class="cursor-pointer bg-white/5 p-2 rounded-lg border border-dashed border-white/20">
                                                                    <i data-lucide="camera" class="w-3 h-3"></i>
                                                                    <input type="file" id="photo-upload-${o.cloudId}" class="hidden" accept="image/*" capture="environment">
                                                                </label>
                                                            ` : ''}
                                                        </div>
                                                    `;
                                                }).join('')}
                                            </div>
                                        </div>
                                        <div class="bg-black/40 rounded-2xl p-6 text-xs space-y-2 border border-white/5">
                                            ${o.items.map(i => `<div class="flex justify-between"><span>${i.qty}x ${i.name}</span><span class="opacity-30">â‚¹${i.price*i.qty}</span></div>`).join('')}
                                        </div>
                                        <div class="mt-6 flex justify-between items-end">
                                            <span class="text-orange-500 font-black text-xl">â‚¹${o.total}</span>
                                            <span class="text-[9px] opacity-20 font-bold">${o.time}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            }
            else if (['admin_login', 'admin'].includes(window.state.view)) {
                container.innerHTML = `
                    <div class="flex-1 bg-slate-50 flex flex-col h-full overflow-hidden">
                        ${window.state.view === 'admin_login' ? `
                            <div class="flex-1 flex flex-col items-center justify-center p-8 bg-white">
                                <i data-lucide="settings" class="w-12 h-12 text-slate-900 mb-6"></i>
                                <h2 class="text-2xl font-black mb-8">Admin Access</h2>
                                <input id="adm-pwd" type="password" placeholder="Admin Passcode" class="w-full max-w-xs bg-slate-50 p-6 rounded-[2rem] text-center mb-4 outline-none border border-slate-100 font-black">
                                <button onclick="if(document.getElementById('adm-pwd').value==='${ADMIN_PASSWORD}') setState({view:'admin'})" class="w-full max-w-xs bg-slate-900 text-white p-6 rounded-[2rem] font-black">Login</button>
                                <button onclick="setState({view:'welcome'})" class="mt-6 text-slate-300 text-xs font-black">Cancel</button>
                            </div>
                        ` : `
                            <header class="p-8 border-b bg-white shrink-0 flex justify-between items-center">
                                <h2 class="font-black text-2xl tracking-tighter">Master Administration</h2>
                                <button onclick="setState({view:'welcome'})" class="bg-slate-100 p-4 rounded-2xl"><i data-lucide="x"></i></button>
                            </header>
                            <div class="flex-1 overflow-y-auto p-8 space-y-6 custom-scrollbar">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    ${window.state.orders.map(o => `
                                        <div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col">
                                            <div class="flex justify-between items-start mb-4">
                                                <div class="flex-1 pr-2">
                                                    <span class="text-[10px] font-black bg-slate-100 px-3 py-1 rounded-full uppercase mb-1 inline-block">${o.id}</span>
                                                    <h3 class="font-black text-sm text-slate-800 break-words">${o.address}</h3>
                                                    <p class="text-[10px] text-slate-400 mt-1">${o.phone}</p>
                                                </div>
                                                <button onclick="deleteOrder('${o.cloudId}')" class="text-red-400 p-2"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                            </div>
                                            
                                            <div class="flex-1 space-y-3 mb-6">
                                                ${o.items.map(i => `
                                                    <div class="text-sm flex justify-between opacity-60">
                                                        <span>${i.qty}x ${i.name}</span>
                                                        <span>â‚¹${i.price*i.qty}</span>
                                                    </div>
                                                `).join('')}
                                            </div>

                                            ${o.completionPhoto ? `
                                                <div class="mt-2 mb-4">
                                                    <p class="text-[9px] font-black uppercase text-slate-400 mb-2">Completion Evidence:</p>
                                                    <img src="${o.completionPhoto}" class="w-full h-48 object-cover rounded-2xl border">
                                                </div>
                                            ` : ''}

                                            <div class="mt-auto pt-4 border-t flex justify-between items-center">
                                                <div>
                                                    <p class="text-[10px] font-black opacity-30 uppercase">Grand Total</p>
                                                    <p class="text-lg font-black text-orange-500">â‚¹${o.total}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-[10px] font-black opacity-30 uppercase">Status</p>
                                                    <p class="text-xs font-bold ${o.status === 3 ? 'text-green-500' : 'text-slate-400'}">
                                                        ${["Received", "Preparing", "On the Way", "Delivered"][o.status]}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `}
                    </div>
                `;
            }
            lucide.createIcons();
        }

        initApp();
    </script>
</body>
</html>
